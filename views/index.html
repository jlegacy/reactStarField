<!DOCTYPE html>
  <head>
    <meta http-equiv='Content-type' content='text/html; charset=utf-8'>
    <title>Basic Example with JSX</title>
    <link rel="stylesheet" href="../shared/css/base.css" />
	 <link rel="stylesheet" href="./css/tictactoe.css" />
  </head>
 
    <h1>Basic Example with JSX</h1>
	<div id="container"></div>
   
    <script src="../../build/react.js"></script>
    <script src="../../build/JSXTransformer.js"></script>
	<script src="//cdnjs.cloudflare.com/ajax/libs/lodash.js/2.4.1/lodash.min.js"></script>
   <body>

   <script type="text/jsx">
   	/** @jsx React.DOM */
	var TicTacToeDrawGrid = React.createClass({
		
	  checkWinning: function(propsCopy)
	  {
		  var found = false;
		  var patterns = [
		  {x:'0',y:'1', z:'2'},
		  {x:'3',y:'4', z:'5'},
		  {x:'6',y:'7', z:'8'},
		  
		  {x:'0',y:'3', z:'6'},
		  {x:'1',y:'4', z:'7'},
		  {x:'2',y:'5', z:'8'},
		  
		  {x:'0',y:'4', z:'8'},
		  {x:'2',y:'4', z:'6'}		
		  ];
		  
		  patterns.map(function (item) {
	   		if (propsCopy[item.x] && propsCopy[item.y] && propsCopy[item.z]) {
				
	   			if (propsCopy[item.x] == propsCopy[item.y] && propsCopy[item.x] == propsCopy[item.z]) {
	   				found = true
	   			}
	   		}
	   	})
		return found;
		  
	  },
		
	  winningMoves: function(x){
		  
		 var propsCopy;
		 var block = false;
		 var meWin = false;
		 var youWin = false;
		 
		 //Check Current Win
		 propsCopy = this.props.items.concat();
		 if (this.checkWinning(propsCopy)) {
		 	youWin = true;
		 }
		 

		 if (!youWin) {
		 	for (var x = 0; x < 9; x++) {
		 		propsCopy = this.props.items.concat();

		 		if (!propsCopy[x]) {
		 			propsCopy[x] = 'X';
		 			if (this.checkWinning(propsCopy)) {
		 				meWin = true;
		 				this.props.items[x] = 'X';
		 				this.setState({
		 					items : this.props.items
		 				});
		 				break;
		 			}
		 		}
		 	}
		 }

		 if (!meWin) {
		 	//Check Block
		 	for (var x = 0; x < 9; x++) {
		 		propsCopy = this.props.items.concat();

		 		if (!propsCopy[x]) {
		 			propsCopy[x] = 'O';
		 			if (this.checkWinning(propsCopy)) {
		 				block = true;
		 				this.props.items[x] = 'X';
		 				this.setState({
		 					items : this.props.items
		 				});
		 				break;
		 			}
		 		}
		 	}

		 }

		 if (!block && !meWin && !youWin) {
		 	this.computerMove();
		 }

		 if (meWin) {
		 	alert('I win');
		 }

		 if (youWin) {
		 	alert('You win');
		 }
		 },

		 computerMove : function () {
		 	for (var x = 0; x < 9; x++) {
		 		if (!this.props.items[x]) {
		 			this.props.items[x] = 'X'
		 				this.setState({
		 					items : this.props.items
		 				});
		 			break;
		 		}
		 	}
		 },

		 handleClick : function (e) {
		 	if (!this.props.items[e]) {
		 		this.props.items[e] = 'O'
		 			this.setState({
		 				items : this.props.items
		 			});
		 		this.winningMoves('Me');
		 	}
		 },
		
	
	  render: function() {
		return (
		<div>
		
			<div id="row1">

				 <TicTacToeCell onClick={this.handleClick} items={this.props.items} num={'0'} id={'left'}/>
				 <TicTacToeCell onClick={this.handleClick} items={this.props.items} num={'1'} id={'middle'}/>
				 <TicTacToeCell onClick={this.handleClick} items={this.props.items} num={'2'} id={'right'}/>

			</div>
			
			<div id="row2">

				 <TicTacToeCell onClick={this.handleClick} items={this.props.items} num={'3'} id={'left'}/>
				 <TicTacToeCell onClick={this.handleClick} items={this.props.items} num={'4'} id={'middle'}/>
				 <TicTacToeCell onClick={this.handleClick} items={this.props.items} num={'5'} id={'right'}/>

			</div>
			
			<div id="row3">

				 <TicTacToeCell onClick={this.handleClick} items={this.props.items} num={'6'} id={'left'}/>
				 <TicTacToeCell onClick={this.handleClick} items={this.props.items} num={'7'} id={'middle'}/>
				 <TicTacToeCell onClick={this.handleClick} items={this.props.items} num={'8'} id={'right'}/>

			</div>
		
		</div>
		 
		);
	  }
	});
	
	var TicTacToeCell = React.createClass({
			render : function () {
				switch (this.props.items[this.props.num]) {
				case 'X':
					return <div className='cross cell-height' onClick={this.props.onClick.bind(this, this.props.num)} id={this.props.id}></div>;
					break;
				case 'O':
					return <div className='circle cell-height' onClick={this.props.onClick.bind(this, this.props.num)} id={this.props.id}></div>;
					break;
				default:
					return <div className='cell-height' onClick={this.props.onClick.bind(this, this.props.num)} id={this.props.id}></div>;
				}
			}
	});
	
	
	var TicTacToeApp = React.createClass({

		getInitialState : function () {
			var items = new Array(9);
			var youOrMe = Math.floor((Math.random() * 2) + 0);
			console.log(youOrMe);
			if (youOrMe == '0'){
				items[Math.floor((Math.random() * 8) + 0)] = 'X';
			}
			
			if (youOrMe == '1'){
				alert('you go first');
			}
			
			return {
				scores : [],
				items : items,
				message : '',
				winner:''
			};
		},
		
	  render: function() {
		return (
		<div>
		 
		 <div id="container">
		 
		 <TicTacToeDrawGrid items={this.state.items}/>
		 
		</div>
		 
		 </div>
		);
	  }
	});
	
	React.render(<TicTacToeApp/>, document.body);
	
	
    </script>
  </body>
